"use strict";var t=require("fs"),e=require("path"),n=require("child_process");function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=r(e),i=r(n),s={__example:"https://github.com/<user>/<repo>/blob/master/docs/RULENAME.md"};var a=function(t){const e=t.split("/");if(1===e.length)return{found:!0,uri:`https://palantir.github.io/tslint/rules/${t}`};const n=e[0],r=e[1],o=s[n];return o?{found:!0,uri:o.replace("RULENAME",r)}:{found:!1,uri:"https://github.com/Xapphire13/tslint-rule-documentation/blob/master/CONTRIBUTING.md"}},u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var l="[object GeneratorFunction]",c=/^\[object .+?Constructor\]$/,f="object"==typeof u&&u&&u.Object===Object&&u,p="object"==typeof self&&self&&self.Object===Object&&self,h=f||p||Function("return this")();function d(t,e){return!!(t?t.length:0)&&function(t,e,n){if(e!=e)return function(t,e,n,r){var o=t.length,i=n+(r?1:-1);for(;r?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,_,n);var r=n-1,o=t.length;for(;++r<o;)if(t[r]===e)return r;return-1}(t,e,0)>-1}function v(t,e,n){for(var r=-1,o=t?t.length:0;++r<o;)if(n(e,t[r]))return!0;return!1}function _(t){return t!=t}function g(t,e){return t.has(e)}function y(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var m,b=Array.prototype,w=Function.prototype,E=Object.prototype,S=h["__core-js_shared__"],P=(m=/[^.]+$/.exec(S&&S.keys&&S.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"",C=w.toString,A=E.hasOwnProperty,T=E.toString,x=RegExp("^"+C.call(A).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),L=b.splice,O=D(h,"Map"),H=D(h,"Set"),j=D(Object,"create");function N(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function $(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function R(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function k(t){var e=-1,n=t?t.length:0;for(this.__data__=new R;++e<n;)this.add(t[e])}function F(t,e){for(var n,r,o=t.length;o--;)if((n=t[o][0])===(r=e)||n!=n&&r!=r)return o;return-1}function K(t){return!(!M(t)||(e=t,P&&P in e))&&(function(t){var e=M(t)?T.call(t):"";return"[object Function]"==e||e==l}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?x:c).test(function(t){if(null!=t){try{return C.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}N.prototype.clear=function(){this.__data__=j?j(null):{}},N.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},N.prototype.get=function(t){var e=this.__data__;if(j){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return A.call(e,t)?e[t]:void 0},N.prototype.has=function(t){var e=this.__data__;return j?void 0!==e[t]:A.call(e,t)},N.prototype.set=function(t,e){return this.__data__[t]=j&&void 0===e?"__lodash_hash_undefined__":e,this},$.prototype.clear=function(){this.__data__=[]},$.prototype.delete=function(t){var e=this.__data__,n=F(e,t);return!(n<0)&&(n==e.length-1?e.pop():L.call(e,n,1),!0)},$.prototype.get=function(t){var e=this.__data__,n=F(e,t);return n<0?void 0:e[n][1]},$.prototype.has=function(t){return F(this.__data__,t)>-1},$.prototype.set=function(t,e){var n=this.__data__,r=F(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},R.prototype.clear=function(){this.__data__={hash:new N,map:new(O||$),string:new N}},R.prototype.delete=function(t){return q(this,t).delete(t)},R.prototype.get=function(t){return q(this,t).get(t)},R.prototype.has=function(t){return q(this,t).has(t)},R.prototype.set=function(t,e){return q(this,t).set(t,e),this},k.prototype.add=k.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},k.prototype.has=function(t){return this.__data__.has(t)};var U=H&&1/y(new H([,-0]))[1]==1/0?function(t){return new H(t)}:function(){};function q(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function D(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return K(n)?n:void 0}function M(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var Y,z=function(t){return t&&t.length?function(t,e,n){var r=-1,o=d,i=t.length,s=!0,a=[],u=a;if(n)s=!1,o=v;else if(i>=200){var l=e?null:U(t);if(l)return y(l);s=!1,o=g,u=new k}else u=e?[]:a;t:for(;++r<i;){var c=t[r],f=e?e(c):c;if(c=n||0!==c?c:0,s&&f==f){for(var p=u.length;p--;)if(u[p]===f)continue t;e&&u.push(f),a.push(c)}else o(u,f,n)||(u!==a&&u.push(f),a.push(c))}return a}(t):[]},W=function(t){var e={exports:{}};return t(e,e.exports),e.exports}((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.assign=e.CACHE_KEY=e.KNOWN_SHELLS=void 0,e.identifyEnvironment=function(){var t=u(),e=t.command,n=t.parameters,r=t.options;return r.timeout=4e3,(0,i.default.spawnSync)(e,n,r).stdout.toString().split("\0")},e.identifyEnvironmentAsync=function(){return new Promise((function(t,e){var n=u(),r=n.command,o=n.parameters,s=n.options,a=(0,i.default.spawn)(r,o,s),l=[],c=setTimeout((function(){a.kill(),e(new Error("Process execution timed out"))}),4e3);a.stdout.on("data",(function(t){l.push(t)})),a.on("close",(function(){clearTimeout(c),t(l.join("").split("\0"))})),a.on("error",(function(t){e(t)}))}))},e.parse=function(t){var e={},n=!0,r=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var a=i.value,u=a.indexOf("=");if(-1!==u){var l=a.slice(0,u),c=a.slice(u+1);e[l]=c}}}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return e},e.applySugar=function(t){var e=process.env.PATH?process.env.PATH.split(":"):[];if(t.PATH){var o=!0,i=!1,s=void 0;try{for(var u,l=t.PATH.split(":")[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;c&&-1===e.indexOf(c)&&e.push(c)}}catch(t){i=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(i)throw s}}}var f=!0,p=!1,h=void 0;try{for(var d,v=a[Symbol.iterator]();!(f=(d=v.next()).done);f=!0){var _=d.value;-1===e.indexOf(_)&&(e=[_].concat(e))}}catch(t){p=!0,h=t}finally{try{!f&&v.return&&v.return()}finally{if(p)throw h}}t.USER||(process.env.USER?t.USER=process.env.USER:t.HOME&&(t.USER=n.default.basename(t.HOME)));return t.PATH=(0,r.default)(e).join(":"),t.PWD=process.cwd(),t.OLDPWD=t.PWD,t},e.getCommand=u;var n=s(o.default),r=s(z);function s(t){return t&&t.__esModule?t:{default:t}}var a=["/bin","/sbin","/usr/bin","/usr/sbin","/usr/local/bin","/usr/local/sbin"];function u(){var t='import os;print(\\"\\0\\".join(map(\\"=\\".join, dict(os.environ).items()))+\\"\\0\\")',e='python -c "'+t+'"||python3 -c "'+t+'"||env|sed -n -e "s/^\\([A-Za-z_][A-Za-z0-9_]*\\)=.*/\\1/p"|while read name;do [ "$name" != "_" -a -n "$(eval "printf \\"%s\\" \\"\\${$name+x}\\"")" ]&&value="$(eval "printf \\"%s\\" \\"\\${$name}\\"")"&&printf "%s=%s\\0" "$name" "$value";done;exit;',r="sh -c '"+e+"';exit;",o=process.env.SHELL||"sh",i=["-c",r],s=n.default.basename(o);return"bash"===s?i=["-c","source ~/.bashrc;source ~/.bash_profile;"+e]:"zsh"===s?i=["-c","source ~/.zshrc;"+e]:"fish"===s?i=["-c","source ~/.config/fish/config.fish;"+r]:"sh"!==s&&"ksh"!==s||(i=["-c",e]),{command:o,parameters:i,options:{encoding:"utf8"}}}e.KNOWN_SHELLS=["zsh","bash","fish"],e.CACHE_KEY="__STEELBRAIN_CONSISTENT_ENV_V1",e.assign=Object.assign||function(t,e){for(var n in e)({}).hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}})),I=(Y=o.default)&&Y.__esModule?Y:{default:Y};var G=function(){if("win32"===process.platform||!process.env.SHELL)return(0,W.assign)({},process.env);if(u[W.CACHE_KEY])return(0,W.assign)({},u[W.CACHE_KEY]);var t=I.default.basename(process.env.SHELL);if(-1===W.KNOWN_SHELLS.indexOf(t))return(0,W.assign)({},process.env);try{var e=(0,W.applySugar)((0,W.parse)((0,W.identifyEnvironment)()));return u[W.CACHE_KEY]=e,e}catch(t){return console.error("[consistent-env] Unable to determine environment",t),(0,W.assign)({},process.env)}};let B;G.async=function(){return new Promise((function(t){if("win32"!==process.platform&&process.env.SHELL)if(u[W.CACHE_KEY])t((0,W.assign)({},u[W.CACHE_KEY]));else{var e=I.default.basename(process.env.SHELL);-1===W.KNOWN_SHELLS.indexOf(e)?t((0,W.assign)({},process.env)):t((0,W.identifyEnvironmentAsync)().then(W.parse).then(W.applySugar).then((function(t){return u[W.CACHE_KEY]=t,t})))}else t((0,W.assign)({},process.env))})).catch((function(t){return console.error("[consistent-env] Unable to determine environment",t),(0,W.assign)({},process.env)}))};var V=function(){return"win32"===process.platform?process.env.PATH||process.env.Path:(B||(B=G),B().PATH||"")};V.async=function(){return"win32"===process.platform?Promise.resolve(process.env.PATH||process.env.Path):(B||(B=G),B.async().then((function(t){return t.PATH||""})))};const Z=Object.freeze({enableSemanticRules:!1,rulesDirectory:"",fixOnSave:!1,ignoreTypings:!1,useLocalTslint:!0,useGlobalTslint:!1,globalNodePath:""}),{stat:X}=t.promises;process.title="linter-tslint worker";const J=new Map,Q={...Z};let tt,et,nt;function rt(t,e){const n=e||t;return new Promise((e=>{et||(et=require("resolve")),et("tslint",{basedir:n},((n,r,o)=>{let i;!n&&void 0!==r&&o&&/^3|4|5|6\./.test(o.version)&&(i=o.version.startsWith("3")?function(t){function e(t){this.options=t,this.results={}}return Object.assign(e,t),e.prototype={...t.prototype,lint(e,n,r){const o={...this.options,configuration:r},i=new t(e,n,o);this.results=i.lint()},getResult(){return this.results}},e}(require("loophole").allowUnsafeNewFunction((()=>require(r)))):require("loophole").allowUnsafeNewFunction((()=>require(r).Linter)),J.set(t,i)),e(i)}))}))}async function ot(t){const e=o.default.dirname(t);if(J.has(e))return J.get(e);if(Q.useLocalTslint){const t=await rt(e);if(t)return t}if(tt)return J.set(e,tt),tt;if(Q.useGlobalTslint){if(Q.globalNodePath){const t=await rt(e,Q.globalNodePath);if(t)return tt=t,t}let t;try{t=await new Promise(((t,e)=>{const n="win32"===process.platform?"npm.cmd":"npm";i.default.exec(`${n} get prefix`,{env:{...process.env,PATH:V()}},((n,r,o)=>{n||o?e(n||new Error(o)):t(r.trim())}))}))}catch(t){console.warn(`Attempted to load global tslint, but "npm get prefix" failed. Falling back to the packaged version of tslint. You can specify your prefix manually in the settings or linter-tslint config file. If your prefix is specified in the settings, make sure that it is correct.\n\nThe error message encountered was:\n\n${t.message}`)}if(t){const n=await rt(e,t);if(n)return tt=n,n;console.warn(`Unable to find global installation of tslint at ${t}. Falling back to the packaged version of tslint. If you have not done so, install tslint by running "npm install -g tslint" from the command line.`)}}return tt=require("tslint").Linter,J.set(e,tt),tt}function it(t){const e=t.ruleSeverity.toLowerCase();return["info","warning","error"].includes(e)?e:"warning"}async function st(t,e,n){if(null==e)return null;let r;try{const i=await ot(e);if(!i)throw new Error(`tslint was not found for ${e}`);const{configurationPath:s,configuration:a}=function(t,e){var n,r,o;let i,s;if("function"==typeof t.findConfiguration){const{path:n,results:r}=t.findConfiguration(null,e);i=n,s=r}else i=t.findConfigurationPath(null,e),s=t.loadConfigurationFromPath(i);let a=null!==(n=null==s?void 0:s.extends)&&void 0!==n?n:[];if(void 0!==i&&void 0!==a&&0===a.length)try{nt||(nt=require("tslint"));const t=(null===(o=(r=nt.Configuration).readConfigurationFile)||void 0===o?void 0:o.call(r,i)).extends;"string"==typeof t?a=[...a,t]:void 0!==t&&(a=[...a,...t])}catch(t){}return{configurationPath:i,configuration:void 0!==s?{...s,extends:a}:s}}(i,e);let u,l=null==a?void 0:a.rulesDirectory;if(l&&s){const t=o.default.dirname(s);Array.isArray(l)||(l=[l]),l=l.map((e=>o.default.isAbsolute(e)?e:o.default.join(t,e))),Q.rulesDirectory&&l.push(Q.rulesDirectory)}Q.enableSemanticRules&&s&&(u=await async function(t,e){let n;const r=o.default.dirname(e),i=o.default.resolve(r,"tsconfig.json");try{(await X(i)).isFile()&&(n=t.createProgram(i,r))}catch(t){}return n}(i,s));const c=new i({formatter:"json",rulesDirectory:l,...n},u);c.lint(e,t,a),r=c.getResult()}catch(t){console.error(t.message,t.stack),r={errorCount:0,warningCount:0,failures:[],format:"",output:""}}return r.failureCount||r.errorCount||r.warningCount||r.infoCount?r.failures.map((t=>{const e=a(t.getRuleName()),n=t.getStartPosition().getLineAndCharacter(),r=t.getEndPosition().getLineAndCharacter();return{severity:it(t),excerpt:`${t.getFailure()} (${t.getRuleName()})`,url:e.uri,location:{file:o.default.normalize(t.getFileName()),position:[[n.line,n.character],[r.line,r.character]]}}})):[]}module.exports=async function(t){Q.useLocalTslint=t.useLocalTslint,Q.enableSemanticRules=t.enableSemanticRules,Q.useGlobalTslint=t.useGlobalTslint,Q.globalNodePath=t.globalNodePath,process.on("message",(async t=>{if("config"===t.messageType)Q[t.message.key]=t.message.value,"useLocalTslint"===t.message.key&&J.clear();else{const{emitKey:e,jobType:n,content:r,filePath:o}=t.message,i="fix"===n?{fix:!0}:{fix:!1},s=await st(r,o,i);emit(e,s)}}))};
//# sourceMappingURL=worker.js.map
